module examples.net_sockets_streams
export main, echoServer

use aivi.net (listen, accept, read, write)

main : Effect Text Unit
main = effect {
  _ <- echoServer 8080
}

echoServer : Int -> Effect Text Unit
echoServer port = effect {
  server <- listen port
  socket <- accept server
  handle socket
}

handle : Socket -> Effect Text Unit
handle socket = effect {
  msg <- read socket
  _ <- write socket msg
  handle socket
}
